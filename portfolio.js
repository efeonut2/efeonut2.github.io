const portfolioItems = [
    {
        id: 5,
        title: "BODRUM AKYARLAR KARAİNCİR SİTESİNDE SATILIK DUBLEKS YAZLIK",
        title_en: "BODRUM AKYARLAR KARAINCIR SITE FOR SALE DUPLEX SUMMER HOUSE",
        location: "Bodrum, Akyarlar",
        location_en: "Bodrum, Akyarlar",
        price: "13.450.000 TL",
        type: "villa",
        images: [
            "bodrum_bodrum (1).png",
            "bodrum_bodrum (2).png",
            "bodrum_bodrum (3).png",
            "bodrum_bodrum (4).png",
            "bodrum_bodrum (5).png",
            "bodrum_bodrum (6).png",
            "bodrum_bodrum (7).png",
            "bodrum_bodrum (8).png",
            "bodrum_bodrum (9).png"
        ],
        coverImage: "bodrum_bodrum (1).png",
        rooms: "3+1",
        area: "130 m²",
        bath: "1",
        status: "Satılık",
        status_en: "For Sale",
        description: "Bodrum Akyarlar Karaincir Sitesi'nde, denize yakın, eşyalı, krediye uygun 3+1 satılık dubleks yazlık.",
        description_en: "Duplex summer house for sale in Bodrum Akyarlar Karaincir Site, close to the sea, furnished, suitable for credit.",
        details: {
            "İlan Tarihi": "26 Kasım 2025",
            "Emlak Tipi": "Satılık Yazlık",
            "m² (Brüt)": "130",
            "m² (Net)": "85",
            "Oda Sayısı": "3+1",
            "Bina Yaşı": "21-25 arası",
            "Bulunduğu Kat": "Müstakil",
            "Kat Sayısı": "2",
            "Isıtma": "Klima",
            "Banyo Sayısı": "1",
            "Mutfak": "Açık (Amerikan)",
            "Balkon": "Var",
            "Eşyalı": "Evet",
            "Kullanım Durumu": "Boş",
            "Site İçerisinde": "Evet",
            "Site Adı": "Karaincir Sitesi",
            "Aidat (TL)": "1.500",
            "Krediye Uygun": "Evet",
            "Tapu Durumu": "Kat Mülkiyetli"
        },
        details_en: {
            "Listing Date": "November 26, 2025",
            "Property Type": "Summer House for Sale",
            "m² (Gross)": "130",
            "m² (Net)": "85",
            "Rooms": "3+1",
            "Building Age": "21-25",
            "Floor": "Detached",
            "Total Floors": "2",
            "Heating": "AC",
            "Bathrooms": "1",
            "Kitchen": "Open Plan",
            "Balcony": "Yes",
            "Furnished": "Yes",
            "Occupancy": "Vacant",
            "In Complex": "Yes",
            "Complex Name": "Karaincir Sitesi",
            "Dues (TL)": "1.500",
            "Credit Eligible": "Yes",
            "Title Deed": "Condo Title"
        }
    },
    {
        id: 4,
        title: "ÜMRANİYE METRONOMDA SATILIK 3+1 KAPALI OTOPARKLI HAVUZLU SIFIR",
        title_en: "UMRANIYE METRONOM FOR SALE 3+1 WITH INDOOR PARKING POOL BRAND NEW",
        location: "Ümraniye",
        location_en: "Umraniye",
        price: "12.000.000 TL",
        type: "satilik",
        images: [
            "umraniye_umraniye (1).png",
            "umraniye_umraniye (2).png",
            "umraniye_umraniye (3).png",
            "umraniye_umraniye (4).png",
            "umraniye_umraniye (5).png",
            "umraniye_umraniye (6).png",
            "umraniye_umraniye (7).png",
            "umraniye_umraniye (8).png",
            "umraniye_umraniye (9).png",
            "umraniye_umraniye (10).png"
        ],
        coverImage: "umraniye_umraniye (1).png",
        rooms: "3+1",
        area: "100 m²",
        bath: "1",
        status: "Satılık",
        status_en: "For Sale",
        description: "Ümraniye Metronom'da, kapalı otoparklı, havuzlu, sıfır 3+1 satılık daire. Krediye uygun, merkezi ısıtmalı fırsat daire.",
        description_en: "Brand new 3+1 apartment for sale in Umraniye Metronom with indoor parking and pool. Credit available, central heating.",
        details: {
            "İlan Tarihi": "26 Kasım 2025",
            "Emlak Tipi": "Satılık Daire",
            "m² (Brüt)": "100",
            "m² (Net)": "80",
            "Oda Sayısı": "3+1",
            "Bina Yaşı": "0 (Oturuma Hazır)",
            "Bulunduğu Kat": "4",
            "Kat Sayısı": "11",
            "Isıtma": "Merkezi (Pay Ölçer)",
            "Banyo Sayısı": "1",
            "Mutfak": "Kapalı",
            "Balkon": "Var",
            "Asansör": "Var",
            "Otopark": "Açık & Kapalı Otopark",
            "Eşyalı": "Hayır",
            "Kullanım Durumu": "Boş",
            "Site İçerisinde": "Evet",
            "Aidat (TL)": "Belirtilmemiş",
            "Krediye Uygun": "Evet",
            "Tapu Durumu": "Kat İrtifaklı"
        },
        details_en: {
            "Listing Date": "November 26, 2025",
            "Property Type": "Apartment for Sale",
            "m² (Gross)": "100",
            "m² (Net)": "80",
            "Rooms": "3+1",
            "Building Age": "0 (New)",
            "Floor": "4",
            "Total Floors": "11",
            "Heating": "Central (Shared Meter)",
            "Bathrooms": "1",
            "Kitchen": "Closed",
            "Balcony": "Yes",
            "Elevator": "Yes",
            "Parking": "Indoor & Outdoor",
            "Furnished": "No",
            "Occupancy": "Vacant",
            "In Complex": "Yes",
            "Dues (TL)": "Not Specified",
            "Credit Eligible": "Yes",
            "Title Deed": "Construction Servitude"
        }
    },
    {
        id: 3,
        title: "SULTANBEYLİ BATTALGAZİ MAH. YENİ BİNADA KİRALIK 3+1",
        title_en: "SULTANBEYLI BATTALGAZI DIST. RENTAL 3+1 IN NEW BUILDING",
        location: "Sultanbeyli, Battalgazi Mh.",
        location_en: "Sultanbeyli, Battalgazi Dist.",
        price: "32.500 TL",
        type: "kiralik",
        images: [
            "sultanbeyli_sultanbeyli (1).png",
            "sultanbeyli_sultanbeyli (2).png",
            "sultanbeyli_sultanbeyli (3).png",
            "sultanbeyli_sultanbeyli (4).png",
            "sultanbeyli_sultanbeyli (5).png",
            "sultanbeyli_sultanbeyli (6).png",
            "sultanbeyli_sultanbeyli (7).png",
            "sultanbeyli_sultanbeyli (8).png",
            "sultanbeyli_sultanbeyli (9).png"
        ],
        coverImage: "sultanbeyli_sultanbeyli (1).png",
        rooms: "3+1",
        area: "120 m²",
        bath: "2",
        status: "Kiralık",
        status_en: "For Rent",
        description: "Sultanbeyli Battalgazi Mahallesi'nde, sıfır binada, ferah ve kullanışlı 3+1 kiralık daire. Oturuma hazırdır.",
        description_en: "Brand new, spacious and useful 3+1 rental apartment in Sultanbeyli Battalgazi District. Ready to move in.",
        details: {
            "İlan Tarihi": "03 Aralık 2025",
            "Emlak Tipi": "Kiralık Daire",
            "m² (Brüt)": "120",
            "m² (Net)": "95",
            "Oda Sayısı": "3+1",
            "Bina Yaşı": "0 (Oturuma Hazır)",
            "Bulunduğu Kat": "5",
            "Kat Sayısı": "8",
            "Isıtma": "Merkezi",
            "Banyo Sayısı": "2",
            "Mutfak": "Kapalı",
            "Balkon": "Var",
            "Asansör": "Var",
            "Otopark": "Açık & Kapalı Otopark",
            "Eşyalı": "Hayır",
            "Kullanım Durumu": "Boş",
            "Site İçerisinde": "Hayır",
            "Aidat (TL)": "1.000",
            "Depozito (TL)": "32.500",
            "Tapu Durumu": "Kat İrtifaklı"
        },
        details_en: {
            "Listing Date": "December 03, 2025",
            "Property Type": "Apartment for Rent",
            "m² (Gross)": "120",
            "m² (Net)": "95",
            "Rooms": "3+1",
            "Building Age": "0 (New)",
            "Floor": "5",
            "Total Floors": "8",
            "Heating": "Central",
            "Bathrooms": "2",
            "Kitchen": "Closed",
            "Balcony": "Yes",
            "Elevator": "Yes",
            "Parking": "Indoor & Outdoor",
            "Furnished": "No",
            "Occupancy": "Vacant",
            "In Complex": "No",
            "Dues (TL)": "1.000",
            "Deposit (TL)": "32.500",
            "Title Deed": "Construction Servitude"
        }
    },
    {
        id: 2,
        title: "MALTEPE ZÜMRÜTEVLER EŞYALI KİRALIK 3+1 ARAKAT DAİRE",
        title_en: "MALTEPE ZUMRUTEVLER FURNISHED RENTAL 3+1 INTERMEDIATE FLOOR APARTMENT",
        location: "Maltepe, Zümrütevler Mh.",
        location_en: "Maltepe, Zumrutevler Dist.",
        price: "44.000 TL",
        type: "kiralik",
        images: [
            "maltepe_maltepe (1).png",
            "maltepe_maltepe (2).png",
            "maltepe_maltepe (3).png",
            "maltepe_maltepe (4).png",
            "maltepe_maltepe (5).png",
            "maltepe_maltepe (6).png",
            "maltepe_maltepe (7).png",
            "maltepe_maltepe (8).png",
            "maltepe_maltepe (9).png",
            "maltepe_maltepe (10).png",
            "maltepe_maltepe (11).png",
            "maltepe_maltepe (12).png"
        ],
        coverImage: "maltepe_maltepe (1).png",
        rooms: "3+1",
        area: "145 m²",
        bath: "1",
        status: "Kiralık",
        status_en: "For Rent",
        description: "Maltepe Zümrütevler'de, Hukukçular ve İdareciler Sitesi içerisinde, full eşyalı, geniş 3+1 kiralık daire. Metroya ve E-5'e yakın konumda.",
        description_en: "Fully furnished, spacious 3+1 rental apartment in Hukukçular and İdareciler Site in Maltepe Zumrutevler. Close to Metro and E-5.",
        details: {
            "İlan Tarihi": "05 Aralık 2025",
            "Emlak Tipi": "Kiralık Daire",
            "m² (Brüt)": "145",
            "m² (Net)": "115",
            "Oda Sayısı": "3+1",
            "Bina Yaşı": "21-25 arası",
            "Bulunduğu Kat": "3",
            "Kat Sayısı": "4",
            "Isıtma": "Merkezi",
            "Banyo Sayısı": "1",
            "Mutfak": "Kapalı",
            "Balkon": "Var",
            "Asansör": "Var",
            "Otopark": "Açık & Kapalı Otopark",
            "Eşyalı": "Evet",
            "Kullanım Durumu": "Boş",
            "Site İçerisinde": "Evet",
            "Site Adı": "Hukukçular Ve İdareciler Sitesi",
            "Aidat (TL)": "2.000",
            "Depozito (TL)": "88.000",
            "Tapu Durumu": "Kat Mülkiyetli"
        },
        details_en: {
            "Listing Date": "December 05, 2025",
            "Property Type": "Apartment for Rent",
            "m² (Gross)": "145",
            "m² (Net)": "115",
            "Rooms": "3+1",
            "Building Age": "21-25",
            "Floor": "3",
            "Total Floors": "4",
            "Heating": "Central",
            "Bathrooms": "1",
            "Kitchen": "Closed",
            "Balcony": "Yes",
            "Elevator": "Yes",
            "Parking": "Indoor & Outdoor",
            "Furnished": "Yes",
            "Occupancy": "Vacant",
            "In Complex": "Yes",
            "Complex Name": "Hukukçular & İdareciler Site",
            "Dues (TL)": "2.000",
            "Deposit (TL)": "88.000",
            "Title Deed": "Condo Title"
        }
    },
    {
        id: 1,
        title: "ÇEKMEKÖY ÇAMLIK MAHALLESİ KİRALIK 2+1 BAHÇE KATI",
        title_en: "CEKMEKOY CAMLIK NEIGHBORHOOD RENTAL 2+1 GARDEN FLOOR",
        location: "Çekmeköy, Çamlık Mh.",
        location_en: "Cekmekoy, Camlik Dist.",
        price: "20.000 TL",
        type: "kiralik",
        images: [
            "camlık_camlık1.png",
            "camlık_camlık2.png",
            "camlık_camlık3.png",
            "camlık_camlık4.png",
            "camlık_camlık5.png",
            "camlık_camlık6.png"
        ],
        coverImage: "assets/images/portfolio/camlik/camlık1.png",
        rooms: "2+1",
        area: "100 m²",
        bath: "1",
        status: "Kiralık",
        status_en: "For Rent",
        description: "Bahçe katında, geniş ve ferah kullanım alanına sahip, doğalgaz kombili kiralık daire.",
        description_en: "Garden floor, spacious and airy rental apartment with combi heating.",
        details: {
            "İlan Tarihi": "11 Aralık 2025",
            "Emlak Tipi": "Kiralık Daire",
            "m² (Brüt)": "100",
            "m² (Net)": "65",
            "Oda Sayısı": "2+1",
            "Bina Yaşı": "11-15 arası",
            "Bulunduğu Kat": "Bahçe Katı",
            "Kat Sayısı": "4",
            "Isıtma": "Kombi (Doğalgaz)",
            "Banyo Sayısı": "1",
            "Mutfak": "Kapalı",
            "Balkon": "Var",
            "Asansör": "Yok",
            "Otopark": "Yok",
            "Eşyalı": "Hayır",
            "Kullanım Durumu": "Boş",
            "Site İçerisinde": "Hayır",
            "Aidat (TL)": "150",
            "Depozito (TL)": "20.000",
            "Tapu Durumu": "Kat İrtifaklı"
        },
        details_en: {
            "Listing Date": "December 11, 2025",
            "Property Type": "Apartment for Rent",
            "m² (Gross)": "100",
            "m² (Net)": "65",
            "Rooms": "2+1",
            "Building Age": "11-15",
            "Floor": "Garden Floor",
            "Total Floors": "4",
            "Heating": "Combi (Fas)",
            "Bathrooms": "1",
            "Kitchen": "Closed",
            "Balcony": "Yes",
            "Elevator": "No",
            "Parking": "No",
            "Furnished": "No",
            "Occupancy": "Vacant",
            "In Complex": "No",
            "Dues (TL)": "150",
            "Deposit (TL)": "20.000",
            "Title Deed": "Construction Servitude"
        }
    }
];

const container = document.getElementById('portfolioContainer');
const searchInput = document.getElementById('searchInput');
const typeFilter = document.getElementById('typeFilter');
const searchBtn = document.getElementById('searchBtn');

// Modal Elements
const modal = document.getElementById('listingModal');
const closeModal = document.querySelector('.close-modal');
const modalMainImage = document.getElementById('modalMainImage');
const modalThumbnails = document.getElementById('modalThumbnails');
const modalTitle = document.getElementById('modalTitle');
const modalLocation = document.getElementById('modalLocation');
const modalPrice = document.getElementById('modalPrice');
const modalDetailsGrid = document.getElementById('modalDetailsGrid');
const modalDescription = document.getElementById('modalDescription');

// Check Language
const isEnglish = document.documentElement.lang === 'en';

function renderPortfolio(items) {
    container.innerHTML = '';

    // No results message
    const noResultsTitle = isEnglish ? "No results found." : "Sonuç bulunamadı.";
    const noResultsDesc = isEnglish ? "Please try different search criteria." : "Lütfen farklı arama kriterleri deneyiniz.";

    if (items.length === 0) {
        container.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 2rem;"><h3>${noResultsTitle}</h3><p>${noResultsDesc}</p></div>`;
        return;
    }

    // Button Text
    const detailBtnText = isEnglish ? "View Details" : "Detayları Gör";

    items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'listing-card animate-up';

        // Data to display
        const displayTitle = isEnglish ? (item.title_en || item.title) : item.title;
        const displayLocation = isEnglish ? (item.location_en || item.location) : item.location;
        const displayStatus = isEnglish ? (item.status_en || item.status) : item.status;

        const badgeColor = item.status === 'Kiralık' ? 'rent' : '';

        card.innerHTML = `
            <div class="card-image">
                <img src="${item.coverImage}" alt="${displayTitle}">
                <span class="tag ${badgeColor}">${displayStatus}</span>
                <span class="price-tag ${badgeColor}">${item.price}</span>
                <div class="card-overlay">
                    <button class="view-btn" data-id="${item.id}">${detailBtnText}</button>
                </div>
            </div>
            <div class="card-content">
                <div class="location">
                    <i class="fas fa-map-marker-alt"></i> ${displayLocation}
                </div>
                <h3 class="card-title">${displayTitle}</h3>
                <div class="features">
                    <span><i class="fas fa-bed"></i> ${item.rooms}</span>
                    <span><i class="fas fa-ruler-combined"></i> ${item.area}</span>
                    <span><i class="fas fa-bath"></i> ${item.bath}</span>
                </div>
            </div>
        `;
        container.appendChild(card);

        const viewBtn = card.querySelector('.view-btn');
        viewBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            openModal(item);
        });

        card.addEventListener('click', () => {
            openModal(item);
        });
    });
}

function openModal(item) {
    if (!modal) return;

    const displayTitle = isEnglish ? (item.title_en || item.title) : item.title;
    const displayLocation = isEnglish ? (item.location_en || item.location) : item.location;
    const displayDescription = isEnglish ? (item.description_en || item.description) : item.description;
    const displayDetails = isEnglish ? (item.details_en || item.details) : item.details;
    const contactBtnText = isEnglish ? "Contact Agent" : "İletişime Geç";

    modalTitle.textContent = displayTitle;
    modalLocation.innerHTML = `<i class="fas fa-map-marker-alt"></i> ${displayLocation}`;
    modalPrice.textContent = item.price;
    modalDescription.textContent = displayDescription;

    // Set Main Image
    modalMainImage.src = item.images[0];

    // Generate Thumbnails
    modalThumbnails.innerHTML = '';
    item.images.forEach((imgSrc, index) => {
        const thumb = document.createElement('img');
        thumb.src = imgSrc;
        thumb.className = index === 0 ? 'thumb active' : 'thumb';
        thumb.onclick = () => {
            modalMainImage.src = imgSrc;
            document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
            thumb.classList.add('active');
        };
        modalThumbnails.appendChild(thumb);
    });

    // Generate Details Grid
    modalDetailsGrid.innerHTML = '';
    for (const [key, value] of Object.entries(displayDetails)) {
        const detailDiv = document.createElement('div');
        detailDiv.className = 'detail-item';
        detailDiv.innerHTML = `
            <span class="detail-label">${key}</span>
            <span class="detail-value">${value}</span>
        `;
        modalDetailsGrid.appendChild(detailDiv);
    }

    // Update Contact Button Text in Modal if necessary (usually only icon or icon + text)
    // The button is static HTML in portfolio.html, I should select it and update text
    const contactBtn = modal.querySelector('.contact-agent-btn a');
    if (contactBtn) {
        contactBtn.innerHTML = `<i class="fab fa-whatsapp"></i> ${contactBtnText}`;
    }

    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

function closeListingModal() {
    modal.classList.remove('show');
    document.body.style.overflow = '';
}

if (closeModal) {
    closeModal.addEventListener('click', closeListingModal);
}

window.addEventListener('click', (e) => {
    if (e.target == modal) {
        closeListingModal();
    }
});

// Helper function
function normalizeString(str) {
    return str.toLocaleLowerCase('tr-TR')
        .replace(/ğ/g, 'g')
        .replace(/ü/g, 'u')
        .replace(/ş/g, 's')
        .replace(/ı/g, 'i')
        .replace(/ö/g, 'o')
        .replace(/ç/g, 'c');
}

function filterItems() {
    const rawSearchTerm = searchInput ? searchInput.value : '';
    const normalizedSearchTerm = normalizeString(rawSearchTerm);
    const selectedType = typeFilter ? typeFilter.value : '';

    const filtered = portfolioItems.filter(item => {
        // Search in both TR and EN titles/locations
        const titleTR = normalizeString(item.title);
        const locTR = normalizeString(item.location);
        const titleEN = normalizeString(item.title_en || "");
        const locEN = normalizeString(item.location_en || "");

        const matchesSearch = titleTR.includes(normalizedSearchTerm) ||
            locTR.includes(normalizedSearchTerm) ||
            titleEN.includes(normalizedSearchTerm) ||
            locEN.includes(normalizedSearchTerm);

        const matchesType = selectedType === '' || item.type === selectedType;

        return matchesSearch && matchesType;
    });

    renderPortfolio(filtered);
}

if (searchBtn) {
    searchBtn.addEventListener('click', filterItems);
}

if (searchInput) {
    searchInput.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') {
            filterItems();
        } else {
            filterItems();
        }
    });
}

if (typeFilter) {
    typeFilter.addEventListener('change', filterItems);
}

document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q');

    if (query && searchInput) {
        searchInput.value = query;
    }

    filterItems();
});
